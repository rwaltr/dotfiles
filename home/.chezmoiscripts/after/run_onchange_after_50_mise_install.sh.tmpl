#!/usr/bin/env bash
# vi: ft=sh
# Install all tools declared in ~/.config/mise/config.toml.
# run_onchange — reruns whenever the mise config changes.
#
# config hash: {{ include (joinPath .chezmoi.sourceDir "dot_config/mise/config.toml") | sha256sum }}

set -euo pipefail

{{ if eq .chezmoi.os "linux" -}}
# Ensure brew-installed mise is on PATH
if ! command -v mise &>/dev/null; then
	if [[ -x /home/linuxbrew/.linuxbrew/bin/mise ]]; then
		eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
	else
		echo "WARN: mise not found — brew bundle may not have run yet. Skipping." >&2
		exit 0
	fi
fi
{{- else }}
if ! command -v mise &>/dev/null; then
	echo "WARN: mise not found. Skipping." >&2
	exit 0
fi
{{- end }}

echo "Running mise install..."
mise install --yes
